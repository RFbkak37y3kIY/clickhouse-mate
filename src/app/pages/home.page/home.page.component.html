<mat-toolbar color="primary" class="ukranian-bg">
    <button
        mat-icon-button
        class="example-icon"
        (click)="isLeftPanel = !isLeftPanel"
    >
        <mat-icon>menu</mat-icon>
    </button>
    <span style="font-size: 20px !important">ClickHouse Mate</span>
    <span class="example-spacer"></span>
    <!-- <span> {{ dbLink }} : {{ dbLogin }} </span> -->
    <button
        [matTooltip]="'READONLY TURN ' + (isReadonly ? 'ON' : 'OFF') + ''"
        mat-icon-button
        class="example-icon"
        (click)="setReadonly(!isReadonly)"
    >
        <mat-icon *ngIf="isReadonly">lock</mat-icon>
        <mat-icon *ngIf="!isReadonly">lock_open</mat-icon>
    </button>
    <button
        [matTooltip]="'DARK MODE TURN ' + (isDarkMode ? 'ON' : 'OFF') + ''"
        mat-icon-button
        class="example-icon"
        (click)="isDarkMode = !isDarkMode"
    >
        <mat-icon *ngIf="isDarkMode">dark_mode</mat-icon>
        <mat-icon *ngIf="!isDarkMode">brightness_5</mat-icon>
    </button>
    <button mat-icon-button class="example-icon" (click)="isAccess = !isAccess">
        <mat-icon>settings</mat-icon>
    </button>
</mat-toolbar>

<div
    [ngClass]="{ dark: isDarkMode }"
    style="width: 100%; height: calc(100vh - 4rem)"
>
    <as-split direction="horizontal">
        <as-split-area
            [size]="15"
            [visible]="isLeftPanel"
            [useTransition]="true"
            [order]="0"
        >
            <mat-accordion class="dashboard-accordion">
                <mat-expansion-panel
                    [expanded]="!!this.dbTreeData && this.dbTreeData.length > 0"
                >
                    <mat-expansion-panel-header>
                        <mat-panel-title> DB Tree </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div
                        *ngIf="!this.dbTreeData || this.dbTreeData.length === 0"
                        style="height: 300px"
                    >
                        <loading></loading>
                    </div>
                    <div *ngIf="this.dbTreeData.length > 0">
                        <tree-filter
                            [data]="dbTreeData"
                            [isFilter]="false"
                            [fileIcon]="true"
                            (clickRow)="onDbChoose($event)"
                        ></tree-filter>
                    </div>
                </mat-expansion-panel>
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title> Query Presets </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div
                        class="archive-line"
                        *ngFor="let item of PopularQueries"
                        (click)="SQL(item)"
                    >
                        {{ item }}
                    </div>
                </mat-expansion-panel>
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title> Query History </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div
                        *ngFor="let item of SqlArchive"
                        (click)="SQL(item)"
                        class="archive-line"
                    >
                        {{ item }}
                    </div>
                </mat-expansion-panel>
                <!-- <mat-expansion-panel *ngIf="currentRow.size > 0">
                    {{ currentRow.size }}
                    <mat-expansion-panel-header>
                        <mat-panel-title> Row Details </mat-panel-title>
                    </mat-expansion-panel-header>

                    <app-row-details [row]="currentRow"> </app-row-details>
                </mat-expansion-panel> -->
                <mat-expansion-panel
                    *ngIf="isDocsShows"
                    [expanded]="isDocsShows"
                >
                    <mat-expansion-panel-header>
                        <mat-panel-title> Docs </mat-panel-title>
                    </mat-expansion-panel-header>

                    <!-- <app-row-details [row]="currentRow"> </app-row-details> -->
                    <app-ch-help
                        style="height: calc(100% - 8rem)"
                    ></app-ch-help>
                </mat-expansion-panel>
            </mat-accordion>
        </as-split-area>
        <as-split-area
            [size]="85"
            [order]="1"
            style="display: flex; flex-direction: column"
        >
            <as-split direction="vertical" [gutterSize]="5">
                <as-split-area
                    [size]="10"
                    [order]="0"
                    style="position: relative"
                >
                    <ace-editor-ext
                        [isDarkMode]="isDarkMode"
                        [(sqlRequest)]="sqlRequest"
                        (ready)="onClickRun($event)"
                        [dictionaryFull]="dictionary"
                    ></ace-editor-ext>
                </as-split-area>
                <as-split-area [size]="90">
                    <div class="data-place">
                        <ng-container
                            *ngIf="details.length === 0; else hasData"
                        >
                            <h1>No Data</h1>
                            <div
                                class="error-message"
                                mat-flat-button
                                color="warn"
                                *ngIf="errorMessage"
                                style="white-space: pre-wrap; width: 100%"
                            >
                                {{ errorMessage }}
                            </div>
                        </ng-container>
                        <ng-template #hasData>
                            <div class="short-stat">
                                <div>
                                    <strong>Elapsed: </strong>
                                    <span>{{
                                        timeShorter(
                                            dataForFile?.statistics?.elapsed ||
                                                0
                                        )
                                    }}</span>
                                </div>
                                <div>
                                    <strong>Rows: </strong>
                                    <span>{{
                                        dataForFile?.statistics?.rows_read
                                    }}</span>
                                </div>
                                <div>
                                    <strong>Size: </strong>
                                    <span>
                                        {{
                                            bytesToSize(
                                                dataForFile?.statistics
                                                    ?.bytes_read || 0
                                            )
                                        }}
                                    </span>
                                </div>
                            </div>
                            <custom-ag-grid
                                *ngIf="isObjectData(); else preText"
                                class="example-table-containers"
                                [itemList]="[
                                    'Save as JSON',
                                    'Save as JSONCompact',
                                    'Save as CSV'
                                ]"
                                (menuClick)="save($event)"
                                [details]="details"
                                [columns]="columns"
                                [(pageSize)]="pageSize"
                                [(isPaginator)]="isPaginator"
                                (rowClick)="openRow($event)"
                            ></custom-ag-grid>
                            <ng-template #preText>
                                <pre>{{ details }}</pre>
                            </ng-template>
                        </ng-template>
                        <div class="data-loader" *ngIf="isLoadingDetails">
                            <loading></loading>
                        </div>
                    </div>
                </as-split-area>
            </as-split>
        </as-split-area>
        <!-- <as-split-area
            [visible]="isDocsShows"
            [size]="15"
            [order]="2"
            style="display: flex; overflow: hidden"
        >
            <app-ch-help></app-ch-help>
        </as-split-area> -->
    </as-split>
</div>

<app-login-form
    [isAccess]="isAccess"
    [settings]="{ dbLink, dbLogin, dbPassword }"
    [errorMessage]="authErrorMessage"
    (ready)="connectToDB($event)"
></app-login-form>
